{"version":3,"file":"index.min.js","sources":["../src/index.js"],"sourcesContent":["// @flow\n/*\n\nhigh performance StyleSheet for css-in-js systems\n\n- uses multiple style tags behind the scenes for millions of rules\n- uses `insertRule` for appending in production for *much* faster performance\n- 'polyfills' on server side\n\n// usage\n\nimport StyleSheet from 'glamor/lib/sheet'\nlet styleSheet = new StyleSheet()\n\nstyleSheet.inject()\n- 'injects' the stylesheet into the page (or into memory if on server)\n\nstyleSheet.insert('#box { border: 1px solid red; }')\n- appends a css rule into the stylesheet\n\nstyleSheet.flush()\n- empties the stylesheet of all its contents\n\n*/\n\n// $FlowFixMe\nfunction sheetForTag(tag: HTMLStyleElement): CSSStyleSheet {\n  if (tag.sheet) {\n    // $FlowFixMe\n    return tag.sheet\n  }\n\n  // this weirdness brought to you by firefox\n  /* istanbul ignore next */\n  for (let i = 0; i < document.styleSheets.length; i++) {\n    if (document.styleSheets[i].ownerNode === tag) {\n      // $FlowFixMe\n      return document.styleSheets[i]\n    }\n  }\n}\n\nexport type Options = {\n  nonce?: string,\n  key: string,\n  container: HTMLElement,\n  speedy?: boolean,\n  maxLength?: number\n}\n\nfunction createStyleElement(options: {\n  key: string,\n  nonce: string | void\n}): HTMLStyleElement {\n  let tag = document.createElement('style')\n  tag.setAttribute('data-emotion', options.key)\n  if (options.nonce !== undefined) {\n    tag.setAttribute('nonce', options.nonce)\n  }\n  tag.appendChild(document.createTextNode(''))\n  return tag\n}\n\nexport class StyleSheet {\n  isSpeedy: boolean\n  ctr: number\n  tags: HTMLStyleElement[]\n  container: HTMLElement\n  maxLength: number\n  key: string\n  nonce: string | void\n  before: Element | null | void\n  constructor(options: Options) {\n    this.isSpeedy =\n      options.speedy === undefined\n        ? process.env.NODE_ENV === 'production'\n        : options.speedy\n    // maxLength is how many rules we have per style tag, it's 65000 in speedy mode\n    // it's 1 in dev because we insert source maps that map a single rule to a location\n    // and you can only have one source map per style tag\n    this.maxLength = this.isSpeedy ? 65000 : 1\n    this.tags = []\n    this.ctr = 0\n    this.nonce = options.nonce\n    // key is the value of the data-emotion attribute, it's used to identify different sheets\n    this.key = options.key\n    this.container = options.container\n  }\n  insert(rule: string) {\n    if (this.ctr % this.maxLength === 0) {\n      let tag = createStyleElement(this)\n      let before\n      if (this.tags.length === 0) {\n        before = this.before\n      } else {\n        before = this.tags[this.tags.length - 1].nextSibling\n      }\n      this.container.insertBefore(tag, before)\n      this.tags.push(tag)\n    }\n    const tag = this.tags[this.tags.length - 1]\n\n    if (this.isSpeedy) {\n      const sheet = sheetForTag(tag)\n      try {\n        // this is the ultrafast version, works across browsers\n        // the big drawback is that the css won't be editable in devtools\n        sheet.insertRule(rule, sheet.cssRules.length)\n      } catch (e) {\n        if (process.env.NODE_ENV !== 'production') {\n          console.warn(\n            `There was a problem inserting the following rule: \"${rule}\"`,\n            e\n          )\n        }\n      }\n    } else {\n      tag.appendChild(document.createTextNode(rule))\n    }\n    this.ctr++\n  }\n  flush() {\n    // $FlowFixMe\n    this.tags.forEach(tag => tag.parentNode.removeChild(tag))\n    this.tags = []\n    this.ctr = 0\n  }\n}\n"],"names":["StyleSheet","options","isSpeedy","undefined","speedy","maxLength","this","tags","ctr","nonce","key","container","insert","rule","before","tag","document","createElement","setAttribute","appendChild","createTextNode","length","nextSibling","insertBefore","push","sheet","i","styleSheets","ownerNode","sheetForTag","insertRule","cssRules","e","flush","forEach","parentNode","removeChild"],"mappings":"mMA+DaA,EAAb,sBAScC,QACLC,cACgBC,IAAnBF,EAAQG,QAEJH,EAAQG,YAITC,UAAYC,KAAKJ,SAAW,KAAQ,OACpCK,KAAO,QACPC,IAAM,OACNC,MAAQR,EAAQQ,WAEhBC,IAAMT,EAAQS,SACdC,UAAYV,EAAQU,qCAE3BC,gBAAOC,MACDP,KAAKE,IAAMF,KAAKD,WAAc,EAAG,KAE/BS,EADAC,GAxCkBd,EAwCOK,MApC7BS,EAAMC,SAASC,cAAc,UAC7BC,aAAa,eAAgBjB,EAAQS,UACnBP,IAAlBF,EAAQQ,OACVM,EAAIG,aAAa,QAASjB,EAAQQ,OAEpCM,EAAII,YAAYH,SAASI,eAAe,KACjCL,GAiCDD,EADuB,IAArBR,KAAKC,KAAKc,OACHf,KAAKQ,OAELR,KAAKC,KAAKD,KAAKC,KAAKc,OAAS,GAAGC,iBAEtCX,UAAUY,aAAaR,EAAKD,QAC5BP,KAAKiB,KAAKT,GAhDrB,IAA4Bd,EAItBc,EA8CIA,EAAMT,KAAKC,KAAKD,KAAKC,KAAKc,OAAS,MAErCf,KAAKJ,SAAU,KACXuB,EA7EZ,SAAqBV,MACfA,EAAIU,aAECV,EAAIU,UAKR,IAAIC,EAAI,EAAGA,EAAIV,SAASW,YAAYN,OAAQK,OAC3CV,SAASW,YAAYD,GAAGE,YAAcb,SAEjCC,SAASW,YAAYD,GAkEdG,CAAYd,OAIxBU,EAAMK,WAAWjB,EAAMY,EAAMM,SAASV,QACtC,MAAOW,UASTjB,EAAII,YAAYH,SAASI,eAAeP,SAErCL,SAEPyB,sBAEO1B,KAAK2B,QAAQ,SAAAnB,UAAOA,EAAIoB,WAAWC,YAAYrB,UAC/CR,KAAO,QACPC,IAAM,KA9Df"}